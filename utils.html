<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ids-finder - Utils</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="ids-finder - Utils">
<meta property="og:description" content="">
<meta property="og:site-name" content="ids-finder">
<meta name="twitter:title" content="ids-finder - Utils">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ids-finder</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Results</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Beforerr/ids_finder" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./utils.html">Utils</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_ids_finder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finding magnetic discontinuities</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_pipelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pipelines</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_candidates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Utils</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./missions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missions/juno.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDs from Juno</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missions/stereo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDs from STEREO</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missions/artemis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDs from ARTHEMIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missions/wind.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDs from Wind</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missions/venus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDs from Venus Express</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missions/messenger.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDs from Messenger</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis/or.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SWD Occurence Rate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis/properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SWD Properties</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis/10_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ID classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis/20_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#plotting" id="toc-plotting" class="nav-link active" data-scroll-target="#plotting">Plotting</a>
  <ul class="collapse">
  <li><a href="#savefig" id="toc-savefig" class="nav-link" data-scroll-target="#savefig">savefig</a></li>
  </ul></li>
  <li><a href="#utilities-functions" id="toc-utilities-functions" class="nav-link" data-scroll-target="#utilities-functions">Utilities functions</a>
  <ul class="collapse">
  <li><a href="#pmap" id="toc-pmap" class="nav-link" data-scroll-target="#pmap">pmap</a></li>
  <li><a href="#get_code" id="toc-get_code" class="nav-link" data-scroll-target="#get_code">get_code</a></li>
  </ul></li>
  <li><a href="#kedro" id="toc-kedro" class="nav-link" data-scroll-target="#kedro"><code>Kedro</code></a>
  <ul class="collapse">
  <li><a href="#load_catalog" id="toc-load_catalog" class="nav-link" data-scroll-target="#load_catalog">load_catalog</a></li>
  </ul></li>
  <li><a href="#utils" id="toc-utils" class="nav-link" data-scroll-target="#utils">Utils</a></li>
  <li><a href="#configurations" id="toc-configurations" class="nav-link" data-scroll-target="#configurations">Configurations</a>
  <ul class="collapse">
  <li><a href="#dataconfig" id="toc-dataconfig" class="nav-link" data-scroll-target="#dataconfig">DataConfig</a></li>
  </ul></li>
  <li><a href="#polars" id="toc-polars" class="nav-link" data-scroll-target="#polars"><code>Polars</code></a>
  <ul class="collapse">
  <li><a href="#filter_tranges_df" id="toc-filter_tranges_df" class="nav-link" data-scroll-target="#filter_tranges_df">filter_tranges_df</a></li>
  <li><a href="#filter_tranges" id="toc-filter_tranges" class="nav-link" data-scroll-target="#filter_tranges">filter_tranges</a></li>
  <li><a href="#cdf2pl" id="toc-cdf2pl" class="nav-link" data-scroll-target="#cdf2pl">cdf2pl</a></li>
  <li><a href="#dataframe.plot" id="toc-dataframe.plot" class="nav-link" data-scroll-target="#dataframe.plot">DataFrame.plot</a></li>
  <li><a href="#pl_norm" id="toc-pl_norm" class="nav-link" data-scroll-target="#pl_norm">pl_norm</a></li>
  <li><a href="#partition_data_by_year" id="toc-partition_data_by_year" class="nav-link" data-scroll-target="#partition_data_by_year">partition_data_by_year</a></li>
  <li><a href="#concat_partitions" id="toc-concat_partitions" class="nav-link" data-scroll-target="#concat_partitions">concat_partitions</a></li>
  <li><a href="#concat_df" id="toc-concat_df" class="nav-link" data-scroll-target="#concat_df">concat_df</a></li>
  <li><a href="#resample" id="toc-resample" class="nav-link" data-scroll-target="#resample">resample</a></li>
  <li><a href="#format_timedelta" id="toc-format_timedelta" class="nav-link" data-scroll-target="#format_timedelta">format_timedelta</a></li>
  <li><a href="#lbldataset" id="toc-lbldataset" class="nav-link" data-scroll-target="#lbldataset">LblDataset</a></li>
  <li><a href="#load_lbl" id="toc-load_lbl" class="nav-link" data-scroll-target="#load_lbl">load_lbl</a></li>
  <li><a href="#get_memory_usage" id="toc-get_memory_usage" class="nav-link" data-scroll-target="#get_memory_usage">get_memory_usage</a></li>
  <li><a href="#calc_vec_mag" id="toc-calc_vec_mag" class="nav-link" data-scroll-target="#calc_vec_mag">calc_vec_mag</a></li>
  <li><a href="#juno_get_state" id="toc-juno_get_state" class="nav-link" data-scroll-target="#juno_get_state">juno_get_state</a></li>
  <li><a href="#sat_get_fgm_from_df" id="toc-sat_get_fgm_from_df" class="nav-link" data-scroll-target="#sat_get_fgm_from_df">sat_get_fgm_from_df</a></li>
  <li><a href="#df2ts" id="toc-df2ts" class="nav-link" data-scroll-target="#df2ts">df2ts</a></li>
  <li><a href="#col_renamer" id="toc-col_renamer" class="nav-link" data-scroll-target="#col_renamer">col_renamer</a></li>
  <li><a href="#check_fgm" id="toc-check_fgm" class="nav-link" data-scroll-target="#check_fgm">check_fgm</a></li>
  <li><a href="#download_file" id="toc-download_file" class="nav-link" data-scroll-target="#download_file">download_file</a></li>
  <li><a href="#calc_time_diff" id="toc-calc_time_diff" class="nav-link" data-scroll-target="#calc_time_diff">calc_time_diff</a></li>
  <li><a href="#calc_time_diff-1" id="toc-calc_time_diff-1" class="nav-link" data-scroll-target="#calc_time_diff-1">calc_time_diff</a></li>
  </ul></li>
  <li><a href="#obsolete-codes" id="toc-obsolete-codes" class="nav-link" data-scroll-target="#obsolete-codes">Obsolete codes</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Beforerr/ids_finder/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Utils</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="plotting" class="level2">
<h2 class="anchored" data-anchor-id="plotting">Plotting</h2>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L13" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="savefig" class="level3">
<h3 class="anchored" data-anchor-id="savefig">savefig</h3>
<blockquote class="blockquote">
<pre><code> savefig (name, **kwargs)</code></pre>
</blockquote>
</section>
</section>
<section id="utilities-functions" class="level2">
<h2 class="anchored" data-anchor-id="utilities-functions">Utilities functions</h2>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L45" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="pmap" class="level3">
<h3 class="anchored" data-anchor-id="pmap">pmap</h3>
<blockquote class="blockquote">
<pre><code> pmap (func, *args, **kwargs)</code></pre>
</blockquote>
<p>map with <code>partial</code></p>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L52" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_code" class="level3">
<h3 class="anchored" data-anchor-id="get_code">get_code</h3>
<blockquote class="blockquote">
<pre><code> get_code (data, name)</code></pre>
</blockquote>
</section>
</section>
<section id="kedro" class="level2">
<h2 class="anchored" data-anchor-id="kedro"><code>Kedro</code></h2>
<p>Standard import</p>
<pre class="{python}"><code>from kedro.pipeline import Pipeline, node
from kedro.pipeline.modular_pipeline import pipeline

def create_pipeline(**kwargs) -&gt; Pipeline:
    return pipeline([
        ...
    ])</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kedro.config <span class="im">import</span> OmegaConfigLoader</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kedro.io <span class="im">import</span> DataCatalog</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_catalog(conf_source: <span class="bu">str</span> <span class="op">=</span> <span class="st">"../conf"</span>, catalog_source: <span class="bu">str</span> <span class="op">=</span> <span class="st">"catalog"</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialise a ConfigLoader</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    conf_loader <span class="op">=</span> OmegaConfigLoader(conf_source)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the data catalog configuration from catalog.yml</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    conf_catalog <span class="op">=</span> conf_loader.get(catalog_source)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the DataCatalog instance from the configuration</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> DataCatalog.from_config(conf_catalog)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> catalog</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following <a href="https://Beforerr.github.io/ids_finder/utils.html#load_catalog"><code>load_catalog</code></a> provides project-aware access to the catalog. The preceding <a href="https://Beforerr.github.io/ids_finder/utils.html#load_catalog"><code>load_catalog</code></a> only works when notebook is run from the project root.</p>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L65" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="load_catalog" class="level3">
<h3 class="anchored" data-anchor-id="load_catalog">load_catalog</h3>
<blockquote class="blockquote">
<pre><code> load_catalog (project_path:str='../')</code></pre>
</blockquote>
</section>
</section>
<section id="utils" class="level2">
<h2 class="anchored" data-anchor-id="utils">Utils</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.utils <span class="im">import</span> patch</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> speasy.products <span class="im">import</span> SpeasyVariable</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> humanize <span class="im">import</span> naturalsize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[11/06/23 20:13:04] WARNING  Non compliant ISTP file: Epoch was      _impl.py:77
                             marked as data variable but it has 0               
                             support variable                                   
[11/06/23 20:13:11] WARNING  Non compliant ISTP file: No data       _impl.py:111
                             variable found, this is suspicious                 
[11/06/23 20:13:28] WARNING  Non compliant ISTP file: No data       _impl.py:111
                             variable found, this is suspicious                 
[11/06/23 20:13:41] WARNING  Non compliant ISTP file: No data       _impl.py:111
                             variable found, this is suspicious                 
[11/06/23 20:13:53] WARNING  Non compliant ISTP file: No data       _impl.py:111
                             variable found, this is suspicious                 
[11/06/23 20:14:04] WARNING  Non compliant ISTP file: No data       _impl.py:111
                             variable found, this is suspicious                 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preview(<span class="va">self</span>: SpeasyVariable):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"==========================================="</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Name:         </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Columns:      </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Values Unit:  </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>unit<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Memory usage: </span><span class="sc">{</span>naturalsize(<span class="va">self</span>.nbytes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Axes Labels:  </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>axes_labels<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-------------------------------------------"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Meta-data:    </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>meta<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-------------------------------------------"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Time Axis:    </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>time[:<span class="dv">3</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-------------------------------------------"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Values:       </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>values[:<span class="dv">3</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"==========================================="</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="configurations" class="level2">
<h2 class="anchored" data-anchor-id="configurations">Configurations</h2>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L82" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dataconfig" class="level3">
<h3 class="anchored" data-anchor-id="dataconfig">DataConfig</h3>
<blockquote class="blockquote">
<pre><code> DataConfig (sat_id:str=None, start:datetime.datetime=None,
             end:datetime.datetime=None, ts:datetime.timedelta=None,
             coord:str=None)</code></pre>
</blockquote>
<p>Create a new model by parsing and validating input data from keyword arguments.</p>
<p>Raises ValidationError if the input data cannot be parsed to form a valid model.</p>
</section>
</section>
<section id="polars" class="level2">
<h2 class="anchored" data-anchor-id="polars"><code>Polars</code></h2>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L111" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="filter_tranges_df" class="level3">
<h3 class="anchored" data-anchor-id="filter_tranges_df">filter_tranges_df</h3>
<blockquote class="blockquote">
<pre><code> filter_tranges_df (df:polars.dataframe.frame.DataFrame,
                    tranges:Tuple[list,list], time_col:str='time')</code></pre>
</blockquote>
<ul>
<li>Filter data by time ranges</li>
</ul>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L93" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="filter_tranges" class="level3">
<h3 class="anchored" data-anchor-id="filter_tranges">filter_tranges</h3>
<blockquote class="blockquote">
<pre><code> filter_tranges (time:polars.series.series.Series,
                 tranges:Tuple[list,list])</code></pre>
</blockquote>
<ul>
<li>Filter data by time ranges, return the indices of the time that are in the time ranges (left inclusive, right exclusive)</li>
</ul>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L124" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="cdf2pl" class="level3">
<h3 class="anchored" data-anchor-id="cdf2pl">cdf2pl</h3>
<blockquote class="blockquote">
<pre><code> cdf2pl (file_path:str, var_names:Union[str,list[str]])</code></pre>
</blockquote>
<p>Convert a CDF file to Polars Dataframe.</p>
<p>Parameters: file_path (str): The path to the CDF file. var_names (Union[str, List[str]]): The name(s) of the variable(s) to retrieve from the CDF file.</p>
<p>Returns: pl.LazyFrame: A lazy dataframe containing the requested data.</p>
<hr>
</section>
<section id="dataframe.plot" class="level3">
<h3 class="anchored" data-anchor-id="dataframe.plot">DataFrame.plot</h3>
<blockquote class="blockquote">
<pre><code> DataFrame.plot (*args, **kwargs)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L186" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="pl_norm" class="level3">
<h3 class="anchored" data-anchor-id="pl_norm">pl_norm</h3>
<blockquote class="blockquote">
<pre><code> pl_norm (columns, *more_columns)</code></pre>
</blockquote>
<p>Computes the square root of the sum of squares for the given columns.</p>
<p>Args: *columns (str): Names of the columns.</p>
<p>Returns: pl.Expr: Expression representing the square root of the sum of squares.</p>
<section id="partition-the-dataset-by-year" class="level4">
<h4 class="anchored" data-anchor-id="partition-the-dataset-by-year">Partition the dataset by year</h4>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L202" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="partition_data_by_year" class="level3">
<h3 class="anchored" data-anchor-id="partition_data_by_year">partition_data_by_year</h3>
<blockquote class="blockquote">
<pre><code> partition_data_by_year (df:polars.lazyframe.frame.LazyFrame)</code></pre>
</blockquote>
<p>Partition the dataset by year</p>
<p>Args: df: Input DataFrame.</p>
<p>Returns: Partitioned DataFrame.</p>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L233" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="concat_partitions" class="level3">
<h3 class="anchored" data-anchor-id="concat_partitions">concat_partitions</h3>
<blockquote class="blockquote">
<pre><code> concat_partitions (partitioned_input:Dict[str,Callable])</code></pre>
</blockquote>
<p>Concatenate input partitions into one DataFrame.</p>
<p>Args: partitioned_input: A dictionary with partition ids as keys and load functions as values.</p>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L219" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="concat_df" class="level3">
<h3 class="anchored" data-anchor-id="concat_df">concat_df</h3>
<blockquote class="blockquote">
<pre><code> concat_df (dfs:list[typing.Union[polars.dataframe.frame.DataFrame,polars.
            lazyframe.frame.LazyFrame,pandas.core.frame.DataFrame]])</code></pre>
</blockquote>
<p>Concatenate a list of DataFrames into one DataFrame.</p>
<section id="resample-data" class="level4">
<h4 class="anchored" data-anchor-id="resample-data">Resample data</h4>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L258" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="resample" class="level3">
<h3 class="anchored" data-anchor-id="resample">resample</h3>
<blockquote class="blockquote">
<pre><code> resample
           (df:polars.dataframe.frame.DataFrame|polars.lazyframe.frame.Laz
           yFrame, every:datetime.timedelta|str|int,
           period:str|datetime.timedelta=None, time_column='time')</code></pre>
</blockquote>
<p>Resample the DataFrame</p>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L247" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="format_timedelta" class="level3">
<h3 class="anchored" data-anchor-id="format_timedelta">format_timedelta</h3>
<blockquote class="blockquote">
<pre><code> format_timedelta (time)</code></pre>
</blockquote>
<p>Format timedelta to <code>timedelta</code></p>
<section id="read-lbl-file" class="level4">
<h4 class="anchored" data-anchor-id="read-lbl-file">Read <code>lbl</code> file</h4>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L310" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="lbldataset" class="level3">
<h3 class="anchored" data-anchor-id="lbldataset">LblDataset</h3>
<blockquote class="blockquote">
<pre><code> LblDataset (filepath:str, load_type:str='table',
             metadata:Dict[str,Any]=None)</code></pre>
</blockquote>
<p><code>AbstractDataset</code> is the base class for all data set implementations. All data set implementations should extend this abstract class and implement the methods marked as abstract. If a specific dataset implementation cannot be used in conjunction with the <code>ParallelRunner</code>, such user-defined dataset should have the attribute <code>_SINGLE_PROCESS = True</code>. Example: ::</p>
<pre><code>&gt;&gt;&gt; from pathlib import Path, PurePosixPath
&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; from kedro.io import AbstractDataset
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; class MyOwnDataset(AbstractDataset[pd.DataFrame, pd.DataFrame]):
&gt;&gt;&gt;     def __init__(self, filepath, param1, param2=True):
&gt;&gt;&gt;         self._filepath = PurePosixPath(filepath)
&gt;&gt;&gt;         self._param1 = param1
&gt;&gt;&gt;         self._param2 = param2
&gt;&gt;&gt;
&gt;&gt;&gt;     def _load(self) -&gt; pd.DataFrame:
&gt;&gt;&gt;         return pd.read_csv(self._filepath)
&gt;&gt;&gt;
&gt;&gt;&gt;     def _save(self, df: pd.DataFrame) -&gt; None:
&gt;&gt;&gt;         df.to_csv(str(self._filepath))
&gt;&gt;&gt;
&gt;&gt;&gt;     def _exists(self) -&gt; bool:
&gt;&gt;&gt;         return Path(self._filepath.as_posix()).exists()
&gt;&gt;&gt;
&gt;&gt;&gt;     def _describe(self):
&gt;&gt;&gt;         return dict(param1=self._param1, param2=self._param2)</code></pre>
<p>Example catalog.yml specification: ::</p>
<pre><code>my_dataset:
    type: &lt;path-to-my-own-dataset&gt;.MyOwnDataset
    filepath: data/01_raw/my_data.csv
    param1: &lt;param1-value&gt; # param1 is a required argument
    # param2 will be True by default</code></pre>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L291" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="load_lbl" class="level3">
<h3 class="anchored" data-anchor-id="load_lbl">load_lbl</h3>
<blockquote class="blockquote">
<pre><code> load_lbl (filepath:str, type:str='table')</code></pre>
</blockquote>
<p>Load LBL data.</p>
<p>Args: filepath: File path to load the data from. type: Type of data to load. Options are ‘table’ and ‘index’.</p>
<p>Returns: A pandas DataFrame containing the loaded data.</p>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L351" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_memory_usage" class="level3">
<h3 class="anchored" data-anchor-id="get_memory_usage">get_memory_usage</h3>
<blockquote class="blockquote">
<pre><code> get_memory_usage (data)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L440" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="calc_vec_mag" class="level3">
<h3 class="anchored" data-anchor-id="calc_vec_mag">calc_vec_mag</h3>
<blockquote class="blockquote">
<pre><code> calc_vec_mag (vec)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L435" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="juno_get_state" class="level3">
<h3 class="anchored" data-anchor-id="juno_get_state">juno_get_state</h3>
<blockquote class="blockquote">
<pre><code> juno_get_state (df:Union[pandas.core.frame.DataFrame,polars.dataframe.fra
                 me.DataFrame,polars.lazyframe.frame.LazyFrame])</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L429" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="sat_get_fgm_from_df" class="level3">
<h3 class="anchored" data-anchor-id="sat_get_fgm_from_df">sat_get_fgm_from_df</h3>
<blockquote class="blockquote">
<pre><code> sat_get_fgm_from_df (df:Union[pandas.core.frame.DataFrame,polars.datafram
                      e.frame.DataFrame,polars.lazyframe.frame.LazyFrame])</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L407" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="df2ts" class="level3">
<h3 class="anchored" data-anchor-id="df2ts">df2ts</h3>
<blockquote class="blockquote">
<pre><code> df2ts (df:Union[pandas.core.frame.DataFrame,polars.dataframe.frame.DataFr
        ame,polars.lazyframe.frame.LazyFrame], cols, attrs=None,
        name=None)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L397" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="col_renamer" class="level3">
<h3 class="anchored" data-anchor-id="col_renamer">col_renamer</h3>
<blockquote class="blockquote">
<pre><code> col_renamer (lbl:str)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L387" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="check_fgm" class="level3">
<h3 class="anchored" data-anchor-id="check_fgm">check_fgm</h3>
<blockquote class="blockquote">
<pre><code> check_fgm (vec:xarray.core.dataarray.DataArray)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/Beforerr/ids_finder/blob/main/ids_finder/utils/basic.py#L365" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="download_file" class="level3">
<h3 class="anchored" data-anchor-id="download_file">download_file</h3>
<blockquote class="blockquote">
<pre><code> download_file (url, local_dir='./', file_name=None)</code></pre>
</blockquote>
<p>Download a file from a URL and save it locally.</p>
<p>Returns: file_path (str): Path to the downloaded file.</p>
<hr>
</section>
<section id="calc_time_diff" class="level3">
<h3 class="anchored" data-anchor-id="calc_time_diff">calc_time_diff</h3>
<blockquote class="blockquote">
<pre><code> calc_time_diff (*args, **kwargs)</code></pre>
</blockquote>
<p>Multiply dispatched method: calc_time_diff</p>
<p>Other signatures: DataFrame LazyFrame</p>
<hr>
</section>
<section id="calc_time_diff-1" class="level3">
<h3 class="anchored" data-anchor-id="calc_time_diff-1">calc_time_diff</h3>
<blockquote class="blockquote">
<pre><code> calc_time_diff (*args, **kwargs)</code></pre>
</blockquote>
<p>Multiply dispatched method: calc_time_diff</p>
<p>Other signatures: DataFrame LazyFrame</p>
</section>
</section>
<section id="obsolete-codes" class="level2">
<h2 class="anchored" data-anchor-id="obsolete-codes">Obsolete codes</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flox.xarray <span class="im">import</span> xarray_reduce</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="at">@dispatch</span>(xr.DataArray, <span class="bu">object</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_index_std(data: DataArray, tau):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Examples</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; i1 = index_std(juno_fgm_b, tau)</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: large tau values will speed up the computation</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Resample the data based on the provided time interval.</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    grouped_data <span class="op">=</span> data.resample(time<span class="op">=</span>pandas.Timedelta(tau, unit<span class="op">=</span><span class="st">"s"</span>))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the standard deviation for all groups</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    vec_stds <span class="op">=</span> linalg.norm(grouped_data.std(dim<span class="op">=</span><span class="st">"time"</span>), dims<span class="op">=</span><span class="st">"v_dim"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vec_stds = grouped_data.map(calc_vec_std) # </span><span class="al">NOTE</span><span class="co">: This is way much slower (like 30x slower)</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> pandas.Timedelta(tau <span class="op">/</span> <span class="dv">2</span>, unit<span class="op">=</span><span class="st">"s"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    vec_stds[<span class="st">"time"</span>] <span class="op">=</span> vec_stds[<span class="st">"time"</span>] <span class="op">+</span> offset</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    vec_stds_next <span class="op">=</span> vec_stds.assign_coords(</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"time"</span>: vec_stds[<span class="st">"time"</span>] <span class="op">-</span> pandas.Timedelta(tau, unit<span class="op">=</span><span class="st">"s"</span>)}</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    vec_stds_previous <span class="op">=</span> vec_stds.assign_coords(</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"time"</span>: vec_stds[<span class="st">"time"</span>] <span class="op">+</span> pandas.Timedelta(tau, unit<span class="op">=</span><span class="st">"s"</span>)}</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.minimum(vec_stds <span class="op">/</span> vec_stds_next, vec_stds <span class="op">/</span> vec_stds_previous)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> index_diff(data: DataArray, tau):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    grouped_data <span class="op">=</span> data.resample(time<span class="op">=</span>pandas.Timedelta(tau, unit<span class="op">=</span><span class="st">'s'</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    dvecs <span class="op">=</span> grouped_data.first()<span class="op">-</span>grouped_data.last()</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    vec_mean_mags <span class="op">=</span> grouped_data.<span class="bu">map</span>(calc_vec_mean_mag)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    vec_diffs <span class="op">=</span> linalg.norm(dvecs, dims<span class="op">=</span><span class="st">'v_dim'</span>) <span class="op">/</span> vec_mean_mags</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vec_diffs = grouped_data.map(calc_vec_relative_diff) # </span><span class="al">NOTE</span><span class="co">: this is slower than the above implementation.</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># INFO: Do your spatial and temporal indexing (e.g. .sel() or .isel()) early in the pipeline, especially before calling resample() or groupby(). Grouping and resampling triggers some computation on all the blocks, which in theory should commute with indexing, but this optimization hasn’t been implemented in Dask yet. (See Dask issue #746).</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> pandas.Timedelta(tau<span class="op">/</span><span class="dv">2</span>, unit<span class="op">=</span><span class="st">'s'</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    vec_diffs[<span class="st">'time'</span>] <span class="op">=</span> vec_diffs[<span class="st">'time'</span>] <span class="op">+</span> offset</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vec_diffs</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># %%</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _compute_indices_old(df: pl.DataFrame, tau):</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute all index based on the given DataFrame and tau value.</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co">    - df (pl.DataFrame): The input DataFrame.</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co">    - tau (int): The time interval value.</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co">    - tuple: Tuple containing DataFrame results for fluctuation index, standard deviation index, and 'index_num'.</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Examples</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; indices = compute_indices(df, tau)</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co">    Notes</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="co">    -----</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Simply shift to calculate index_std would not work correctly if data is missing, like `std_next = pl.col("B_std").shift(-2)`.</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(tau, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>        tau <span class="op">=</span> timedelta(seconds<span class="op">=</span>tau)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    b_cols <span class="op">=</span> [<span class="st">"BX"</span>, <span class="st">"BY"</span>, <span class="st">"BZ"</span>]</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>    db_cols <span class="op">=</span> [<span class="st">"d"</span> <span class="op">+</span> col_name <span class="op">+</span> <span class="st">"_vec"</span> <span class="cf">for</span> col_name <span class="kw">in</span> b_cols]</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    std_next <span class="op">=</span> pl.col(<span class="st">"B_std"</span>).shift(<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    std_current <span class="op">=</span> pl.col(<span class="st">"B_std"</span>)</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    std_previous <span class="op">=</span> pl.col(<span class="st">"B_std"</span>).shift(<span class="dv">2</span>)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>    pl_std_index <span class="op">=</span> pl.min_horizontal(</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>        [std_current <span class="op">/</span> std_previous, std_current <span class="op">/</span> std_next]</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute fluctuation index</span></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    group_df <span class="op">=</span> (</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>        df.with_columns(pl_norm(<span class="st">"BX"</span>, <span class="st">"BY"</span>, <span class="st">"BZ"</span>).alias(<span class="st">"B"</span>))</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>        .group_by_dynamic(<span class="st">"time"</span>, every<span class="op">=</span>tau <span class="op">/</span> <span class="dv">2</span>, period<span class="op">=</span>tau)</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>            pl.count(),</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>            pl.col(b_cols),</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"BX"</span>).std().alias(<span class="st">"BX_std"</span>),</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"BY"</span>).std().alias(<span class="st">"BY_std"</span>),</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"BZ"</span>).std().alias(<span class="st">"BZ_std"</span>),</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"B"</span>).mean().alias(<span class="st">"B_mean"</span>),</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>pl_dvec(b_cols),</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>            pl_norm(<span class="st">"BX_std"</span>, <span class="st">"BY_std"</span>, <span class="st">"BZ_std"</span>).alias(<span class="st">"B_std"</span>),</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>            pl_norm(db_cols).alias(<span class="st">"dB_vec"</span>),</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>        .drop(<span class="st">"BX_std"</span>, <span class="st">"BY_std"</span>, <span class="st">"BZ_std"</span>)</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> (</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>        group_df.with_columns(</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>            calc_combined_std(<span class="st">"BX"</span>),</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>            calc_combined_std(<span class="st">"BY"</span>),</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>            calc_combined_std(<span class="st">"BZ"</span>),</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>        .drop(<span class="st">"BX"</span>, <span class="st">"BY"</span>, <span class="st">"BZ"</span>)</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>            pl_norm(<span class="st">"BX_combined_std"</span>, <span class="st">"BY_combined_std"</span>, <span class="st">"BZ_combined_std"</span>).alias(</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">"B_combined_std"</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>            pl.sum_horizontal(</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>                pl.col(<span class="st">"B_std"</span>).shift(<span class="op">-</span><span class="dv">2</span>), pl.col(<span class="st">"B_std"</span>).shift(<span class="dv">2</span>)</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>            ).alias(<span class="st">"B_added_std"</span>),</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>        .drop(<span class="st">"BX_combined_std"</span>, <span class="st">"BY_combined_std"</span>, <span class="st">"BZ_combined_std"</span>)</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>            pl_std_index.alias(<span class="st">"index_std"</span>),</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"B_combined_std"</span>) <span class="op">/</span> pl.col(<span class="st">"B_added_std"</span>)).alias(</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>                <span class="st">"index_fluctuation"</span></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"dB_vec"</span>) <span class="op">/</span> pl.col(<span class="st">"B_mean"</span>)).alias(<span class="st">"index_diff"</span>),</span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>